<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Fursona</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --primary-bg: #1a1a2e;
            --secondary-bg: #272740;
            --panel-bg: #2e2e4a;
            --accent-color: #6a5acd;
            --accent-hover: #7b68ee;
            --text-color: #e0e0e0;
            --light-text: #c4c4e2;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #0e1e3a);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            overflow-x: hidden;
            position: relative;
            /* Cursor de pata personalizado */
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><path fill='%23e0e0e0' d='M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM128 256a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm104-56a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm96 56a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm-80 120a48 48 0 1 1 96 0 48 48 0 1 1 -96 0z'/></svg>") 16 16, auto;
        }

        .container {
            background-color: var(--secondary-bg);
            border-radius: 2rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            padding: 2.5rem;
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
            animation: slide-up 1s ease-out forwards;
            position: relative;
            z-index: 10;
        }

        @media (min-width: 1024px) {
            .container {
                flex-direction: row;
            }
        }
        
        .panel {
            background-color: var(--panel-bg);
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-weight: 600;
            color: var(--light-text);
        }

        select, input[type="range"], textarea {
            background-color: #38385b;
            border: 1px solid #4a4a75;
            border-radius: 0.75rem;
            padding: 0.75rem;
            color: var(--text-color);
            outline: none;
            transition: all 0.3s ease;
            appearance: none;
        }
        
        select:hover {
            background-color: #4a4a75;
        }

        select:focus, input:focus, textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.5);
        }
        
        textarea {
            min-height: 100px;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent-color);
            border: 3px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
            transition: background 0.3s ease, transform 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--accent-color);
            border: 3px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            font-weight: 700;
            padding: 1rem 2rem;
            border-radius: 1.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            text-align: center;
        }

        .btn:hover {
            background-color: var(--accent-hover);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        
        .btn:disabled {
            background-color: #4a4a75;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }

        .image-container {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            border-radius: 1.5rem;
            overflow: hidden;
            background-color: var(--panel-bg);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
            gap: 1rem;
        }

        #result-image {
            width: 100%;
            height: auto;
            max-height: 100%;
            object-fit: contain;
            border-radius: 1.5rem;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
        }
        
        #result-image.visible {
            opacity: 1;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(46, 46, 74, 0.8);
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease;
            border-radius: 1.5rem;
            text-align: center;
        }
        
        .loading-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            border: 4px solid #4a4a75;
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* Anima√ß√µes de entrada */
        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Part√≠culas de Patinhas */
        .paw-particle {
            position: absolute;
            font-size: 24px;
            color: #ffffff;
            opacity: 0;
            pointer-events: none;
            animation: float-up 5s ease-out forwards;
            z-index: 1; /* Para aparecer atr√°s do conte√∫do */
        }
        
        @keyframes float-up {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            50% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-200px) scale(1.2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <div class="container lg:flex-row">
        <!-- Painel de Controles -->
        <div class="panel" id="main-panel">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-3xl font-bold text-[--light-text]" data-lang-key="createTitle">Criar Meu Fursona</h2>
                <div class="input-group w-32 ml-auto">
                    <label for="languageSelect" class="sr-only" data-lang-key="languageLabel">Idioma</label>
                    <select id="languageSelect" class="w-full">
                        <option value="pt-br">Portugu√™s</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Seletor de Animais -->
                <div class="input-group">
                    <label for="animal1" data-lang-key="animal1Label">Animal 1</label>
                    <select id="animal1" class="w-full"></select>
                </div>
                <div class="input-group">
                    <label for="animal2" data-lang-key="animal2Label">Animal 2 (Opcional)</label>
                    <select id="animal2" class="w-full"></select>
                </div>

                <!-- G√™nero e Estilo de Arte -->
                <div class="input-group">
                    <label for="gender" data-lang-key="genderLabel">G√™nero</label>
                    <select id="gender" class="w-full"></select>
                </div>
                <div class="input-group">
                    <label for="artStyle" data-lang-key="artStyleLabel">Estilo de Arte</label>
                    <select id="artStyle" class="w-full"></select>
                </div>

                <!-- Pose e Fundo -->
                <div class="input-group">
                    <label for="pose" data-lang-key="poseLabel">Pose</label>
                    <select id="pose" class="w-full"></select>
                </div>
                <div class="input-group">
                    <label for="background" data-lang-key="backgroundLabel">Fundo</label>
                    <select id="background" class="w-full"></select>
                </div>
                
                <!-- Enquadramento da Imagem -->
                <div class="input-group">
                    <label for="framing" data-lang-key="framingLabel">Enquadramento da Imagem</label>
                    <select id="framing" class="w-full"></select>
                </div>

                <!-- Cor Principal (TEXTO) -->
                <div class="input-group">
                    <label for="primaryColor" data-lang-key="colorLabel">Cor da Pelagem</label>
                    <textarea id="primaryColor" data-lang-key="colorPlaceholder" placeholder="Ex: golden yellow, crimson red, neon blue..." class="h-12"></textarea>
                </div>

                <!-- Roupa -->
                <div class="input-group">
                    <label for="clothing" data-lang-key="clothingLabel">Roupa</label>
                    <select id="clothing" class="w-full"></select>
                </div>

                <!-- Estilos de Cabelo, Cauda e Orelhas -->
                <div class="input-group">
                    <label for="hairStyle" data-lang-key="hairStyleLabel">Estilo de Cabelo</label>
                    <select id="hairStyle" class="w-full"></select>
                </div>
                <div class="input-group">
                    <label for="tailStyle" data-lang-key="tailStyleLabel">Estilo da Cauda</label>
                    <select id="tailStyle" class="w-full"></select>
                </div>
                <div class="input-group">
                    <label for="earStyle" data-lang-key="earStyleLabel">Estilo das Orelhas</label>
                    <select id="earStyle" class="w-full"></select>
                </div>
            </div>
            
            <!-- Controles de Propor√ß√µes -->
            <div class="mt-4">
                <h3 class="text-xl font-bold text-[--light-text] mb-2" data-lang-key="proportionsTitle">Propor√ß√µes do Corpo</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="input-group slider-group">
                        <label for="headSize" class="w-24" data-lang-key="headSizeLabel">Cabe√ßa</label>
                        <input type="range" id="headSize" min="0" max="100" value="50">
                    </div>
                    <div class="input-group slider-group">
                        <label for="chestSize" class="w-24" data-lang-key="chestSizeLabel">Peito</label>
                        <input type="range" id="chestSize" min="0" max="100" value="50">
                    </div>
                    <div class="input-group slider-group">
                        <label for="legsSize" class="w-24" data-lang-key="legsSizeLabel">Pernas</label>
                        <input type="range" id="legsSize" min="0" max="100" value="50">
                    </div>
                    <div class="input-group slider-group">
                        <label for="bustSize" class="w-24" data-lang-key="bustSizeLabel">Busto</label>
                        <input type="range" id="bustSize" min="0" max="100" value="50">
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label for="traits" data-lang-key="traitsLabel">Tra√ßos e Detalhes Adicionais (opcional)</label>
                <textarea id="traits" data-lang-key="traitsPlaceholder" placeholder="Ex: olhos verdes, cicatriz no rosto, √≥culos..."></textarea>
            </div>
            
            <button id="generate-btn" class="btn mt-4" data-lang-key="generateBtn">Gerar Imagem</button>
        </div>

        <!-- Painel de Edi√ß√£o (Inicialmente Oculto) -->
        <div class="panel hidden" id="edit-panel">
            <h2 class="text-3xl font-bold text-center text-[--light-text] mb-4" data-lang-key="editTitle">Editar Fursona</h2>
            <p class="text-center text-gray-400 mb-6" data-lang-key="editDescription">Altere os detalhes abaixo e clique em "Re-gerar Imagem" para criar uma nova vers√£o.</p>
            
            <div class="input-group">
                <label for="facialExpression" data-lang-key="facialExpressionLabel">Express√£o Facial</label>
                <select id="facialExpression" class="w-full"></select>
            </div>

            <div class="input-group">
                <label for="gazeDirection" data-lang-key="gazeDirectionLabel">Dire√ß√£o do Olhar</label>
                <select id="gazeDirection" class="w-full"></select>
            </div>
            
            <button id="regenerate-btn" class="btn mt-4" data-lang-key="regenerateBtn">Re-gerar Imagem</button>
            <button id="back-btn" class="btn mt-4 bg-gray-600 hover:bg-gray-700" data-lang-key="backBtn">Voltar</button>
        </div>

        <!-- Painel de Imagem -->
        <div class="panel image-container">
            <div class="loading-overlay" id="loading-overlay">
                <div class="spinner"></div>
                <p class="mt-4" id="loading-text" data-lang-key="loadingText">Gerando sua arte...</p>
            </div>
            <img id="result-image" src="" alt="Imagem Gerada">
            
            <div id="action-buttons" class="hidden flex flex-col sm:flex-row gap-4 mt-4">
                <button id="edit-btn" class="btn bg-gray-600 hover:bg-gray-700 w-full sm:w-auto" data-lang-key="editBtn">Editar</button>
                <button id="download-btn" class="btn bg-blue-600 hover:bg-blue-700 w-full sm:w-auto" data-lang-key="downloadBtn">Download</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const languageSelect = document.getElementById('languageSelect');
            const animal1Select = document.getElementById('animal1');
            const animal2Select = document.getElementById('animal2');
            const genderSelect = document.getElementById('gender');
            const artStyleSelect = document.getElementById('artStyle');
            const poseSelect = document.getElementById('pose');
            const backgroundSelect = document.getElementById('background');
            const tailStyleSelect = document.getElementById('tailStyle');
            const earStyleSelect = document.getElementById('earStyle');
            const hairStyleSelect = document.getElementById('hairStyle');
            const clothingSelect = document.getElementById('clothing');
            const framingSelect = document.getElementById('framing');
            const facialExpressionSelect = document.getElementById('facialExpression');
            const gazeDirectionSelect = document.getElementById('gazeDirection');
            
            const generateButton = document.getElementById('generate-btn');
            const regenerateButton = document.getElementById('regenerate-btn');
            const editButton = document.getElementById('edit-btn');
            const backButton = document.getElementById('back-btn');
            const downloadButton = document.getElementById('download-btn');
            const resultImage = document.getElementById('result-image');
            const loadingOverlay = document.getElementById('loading-overlay');
            const loadingText = document.getElementById('loading-text');
            const mainPanel = document.getElementById('main-panel');
            const editPanel = document.getElementById('edit-panel');
            const actionButtonsDiv = document.getElementById('action-buttons');

            const headSizeInput = document.getElementById('headSize');
            const chestSizeInput = document.getElementById('chestSize');
            const legsSizeInput = document.getElementById('legsSize');
            const bustSizeInput = document.getElementById('bustSize');
            const traitsInput = document.getElementById('traits');
            const primaryColorInput = document.getElementById('primaryColor');

            let lastPrompt = '';
            let imageDataUrl = '';

            const translations = {
                'pt-br': {
                    createTitle: 'Criar Meu Fursona',
                    animal1Label: 'Animal 1',
                    animal2Label: 'Animal 2 (Opcional)',
                    genderLabel: 'G√™nero',
                    artStyleLabel: 'Estilo de Arte',
                    poseLabel: 'Pose',
                    backgroundLabel: 'Fundo',
                    framingLabel: 'Enquadramento da Imagem',
                    colorLabel: 'Cor da Pelagem',
                    colorPlaceholder: 'Ex: amarelo dourado, vermelho carmesim, azul neon...',
                    clothingLabel: 'Roupa',
                    hairStyleLabel: 'Estilo de Cabelo',
                    tailStyleLabel: 'Estilo da Cauda',
                    earStyleLabel: 'Estilo das Orelhas',
                    proportionsTitle: 'Propor√ß√µes do Corpo',
                    headSizeLabel: 'Cabe√ßa',
                    chestSizeLabel: 'Peito',
                    legsSizeLabel: 'Pernas',
                    bustSizeLabel: 'Busto',
                    traitsLabel: 'Tra√ßos e Detalhes Adicionais (opcional)',
                    traitsPlaceholder: 'Ex: olhos verdes, cicatriz no rosto, √≥culos...',
                    generateBtn: 'Gerar Imagem',
                    editTitle: 'Editar Fursona',
                    editDescription: 'Altere os detalhes abaixo e clique em "Re-gerar Imagem" para criar uma nova vers√£o.',
                    facialExpressionLabel: 'Express√£o Facial',
                    gazeDirectionLabel: 'Dire√ß√£o do Olhar',
                    regenerateBtn: 'Re-gerar Imagem',
                    backBtn: 'Voltar',
                    editBtn: 'Editar',
                    downloadBtn: 'Download',
                    loadingText: 'Gerando sua arte...',
                    errorText: 'Erro. Tentando novamente...',
                    finalErrorText: 'Erro ao gerar a arte. Por favor, tente novamente.',
                    animals: [{ value: 'cat', text: 'Gato' }, { value: 'wolf', text: 'Lobo' }, { value: 'fox', text: 'Raposa' }, { value: 'tiger', text: 'Tigre' }, { value: 'lion', text: 'Le√£o' }, { value: 'dragon', text: 'Drag√£o' }, { value: 'rabbit', text: 'Coelho' }, { value: 'deer', text: 'Veado' }, { value: 'bear', text: 'Urso' }, { value: 'bird', text: 'P√°ssaro' }, { value: 'shark', text: 'Tubar√£o' }, { value: 'protogen', text: 'Protogen' }, { value: 'hyena', text: 'Hiena' }, { value: 'red panda', text: 'Panda Vermelho' }, { value: 'otter', text: 'Lontra' }, { value: 'skunk', text: 'Gamb√°' }, { value: 'fennec fox', text: 'Raposa Fennec' }, { value: 'goat', text: 'Cabra' }],
                    genders: [{ value: 'male', text: 'Masculino' }, { value: 'female', text: 'Feminino' }],
                    artStyles: [{ value: 'digital art', text: 'Arte Digital' }, { value: 'watercolor painting', text: 'Aquarela' }, { value: 'pixel art', text: 'Pixel Art' }, { value: 'stylized cartoon', text: 'Desenho Animado' }, { value: 'realistic', text: 'Realista' }, { value: 'chibi', text: 'Chibi' }],
                    poses: [{ value: 'standing', text: 'De P√©' }, { value: 'sitting', text: 'Sentado' }, { value: 'running', text: 'Correndo' }, { value: 'walking', text: 'Andando' }, { value: 'jumping', text: 'Saltando' }, { value: 'sitting on a chair', text: 'Sentado em uma cadeira' }, { value: 'dancing', text: 'Dan√ßando' }, { value: 'fighting stance', text: 'Posi√ß√£o de Luta' }, { value: 'looking into a mirror', text: 'Olhando no espelho' }],
                    backgrounds: [{ value: 'minimalist studio background', text: 'Fundo M√≠nimo' }, { value: 'forest', text: 'Floresta' }, { value: 'cityscape', text: 'Paisagem Urbana' }, { value: 'beach', text: 'Praia' }, { value: 'mountains', text: 'Montanhas' }, { value: 'space nebula', text: 'Nebulosa Espacial' }],
                    clothing: [{ value: 'no clothes', text: 'Sem Roupa (Feral SFW)'}, { value: 'casual clothes', text: 'Roupas Casuais'}, { value: 'fantasy armor', text: 'Armadura de Fantasia'}, { value: 'modern street clothes', text: 'Roupas de Rua Modernas'}],
                    hairStyles: [{ value: 'short hair', text: 'Cabelo Curto'}, { value: 'long hair', text: 'Cabelo Longo'}, { value: 'spiky hair', text: 'Cabelo Espetado'}, { value: 'braided hair', text: 'Cabelo Tran√ßado'}, { value: 'no hair', text: 'Nenhum Cabelo'}, { value: 'long ponytail', text: 'Rabo de Cavalo Longo'}, { value: 'mohawk', text: 'Moicano'}, { value: 'shaved head', text: 'Cabe√ßa Raspada'}, { value: 'curly hair', text: 'Cabelo Cacheado'}],
                    tailStyles: [{ value: 'long fluffy tail', text: 'Longa e Fofa' }, { value: 'short bushy tail', text: 'Curta e Cheia' }, { value: 'spiky tail', text: 'Com Espinhos' }, { value: 'thin and long tail', text: 'Fina e Longa' }, { value: 'dragon-like tail', text: 'De Drag√£o' }, { value: 'curly tail', text: 'Cauda Enrolada' }, { value: 'bobtail', text: 'Cauda Curta' }, { value: 'scaly tail', text: 'Cauda Escamosa' }],
                    earStyles: [{ value: 'large pointy ears', text: 'Grandes e Pontudas' }, { value: 'floppy ears', text: 'Ca√≠das' }, { value: 'short and round ears', text: 'Curtas e Redondas' }, { value: 'long rabbit-like ears', text: 'Longas (de Coelho)' }, { value: 'round ears', text: 'Orelhas Redondas' }, { value: 'pointed ears', text: 'Orelhas Pontudas' }, { value: 'folded ears', text: 'Orelhas Dobradas' }],
                    framings: [{ value: 'full body', text: 'Corpo Inteiro' }, { value: 'bust-up', text: 'Busto' }, { value: 'headshot', text: 'Rosto' }, { value: 'half-body', text: 'Meio Corpo' }],
                    facialExpressions: [{ value: 'smiling', text: 'Sorrindo' }, { value: 'neutral', text: 'Neutra' }, { value: 'serious', text: 'S√©ria' }, { value: 'surprised', text: 'Surpresa' }, { value: 'angry', text: 'Com Raiva' }, { value: 'sad', text: 'Triste' }],
                    gazeDirections: [{ value: 'looking straight at the camera', text: 'Olhando para a C√¢mera' }, { value: 'looking to the left', text: 'Olhando para a Esquerda' }, { value: 'looking to the right', text: 'Olhando para a Direita' }, { value: 'looking up', text: 'Olhando para Cima' }, { value: 'looking down', text: 'Olhando para Baixo' }]
                },
                'en': {
                    createTitle: 'Create My Fursona',
                    animal1Label: 'Animal 1',
                    animal2Label: 'Animal 2 (Optional)',
                    genderLabel: 'Gender',
                    artStyleLabel: 'Art Style',
                    poseLabel: 'Pose',
                    backgroundLabel: 'Background',
                    framingLabel: 'Image Framing',
                    colorLabel: 'Fur Color',
                    colorPlaceholder: 'Ex: golden yellow, crimson red, neon blue...',
                    clothingLabel: 'Clothing',
                    hairStyleLabel: 'Hair Style',
                    tailStyleLabel: 'Tail Style',
                    earStyleLabel: 'Ear Style',
                    proportionsTitle: 'Body Proportions',
                    headSizeLabel: 'Head',
                    chestSizeLabel: 'Chest',
                    legsSizeLabel: 'Legs',
                    bustSizeLabel: 'Bust',
                    traitsLabel: 'Additional Traits and Details (optional)',
                    traitsPlaceholder: 'Ex: green eyes, facial scar, glasses...',
                    generateBtn: 'Generate Image',
                    editTitle: 'Edit Fursona',
                    editDescription: 'Change the details below and click "Re-generate Image" to create a new version.',
                    facialExpressionLabel: 'Facial Expression',
                    gazeDirectionLabel: 'Gaze Direction',
                    regenerateBtn: 'Re-generate Image',
                    backBtn: 'Back',
                    editBtn: 'Edit',
                    downloadBtn: 'Download',
                    loadingText: 'Generating your art...',
                    errorText: 'Error. Retrying...',
                    finalErrorText: 'Failed to generate art. Please try again.',
                    animals: [{ value: 'cat', text: 'Cat' }, { value: 'wolf', text: 'Wolf' }, { value: 'fox', text: 'Fox' }, { value: 'tiger', text: 'Tiger' }, { value: 'lion', text: 'Lion' }, { value: 'dragon', text: 'Dragon' }, { value: 'rabbit', text: 'Rabbit' }, { value: 'deer', text: 'Deer' }, { value: 'bear', text: 'Bear' }, { value: 'bird', text: 'Bird' }, { value: 'shark', text: 'Shark' }, { value: 'protogen', text: 'Protogen' }, { value: 'hyena', text: 'Hyena' }, { value: 'red panda', text: 'Red Panda' }, { value: 'otter', text: 'Otter' }, { value: 'skunk', text: 'Skunk' }, { value: 'fennec fox', text: 'Fennec Fox' }, { value: 'goat', text: 'Goat' }],
                    genders: [{ value: 'male', text: 'Male' }, { value: 'female', text: 'Female' }],
                    artStyles: [{ value: 'digital art', text: 'Digital Art' }, { value: 'watercolor painting', text: 'Watercolor Painting' }, { value: 'pixel art', text: 'Pixel Art' }, { value: 'stylized cartoon', text: 'Stylized Cartoon' }, { value: 'realistic', text: 'Realistic' }, { value: 'chibi', text: 'Chibi' }],
                    poses: [{ value: 'standing', text: 'Standing' }, { value: 'sitting', text: 'Sitting' }, { value: 'running', text: 'Running' }, { value: 'walking', text: 'Walking' }, { value: 'jumping', text: 'Jumping' }, { value: 'sitting on a chair', text: 'Sitting on a chair' }, { value: 'dancing', text: 'Dancing' }, { value: 'fighting stance', text: 'Fighting Stance' }, { value: 'looking into a mirror', text: 'Looking into a mirror' }],
                    backgrounds: [{ value: 'minimalist studio background', text: 'Minimalist Studio Background' }, { value: 'forest', text: 'Forest' }, { value: 'cityscape', text: 'Cityscape' }, { value: 'beach', text: 'Beach' }, { value: 'mountains', text: 'Mountains' }, { value: 'space nebula', text: 'Space Nebula' }],
                    clothing: [{ value: 'no clothes', text: 'No Clothes (Feral SFW)'}, { value: 'casual clothes', text: 'Casual Clothes'}, { value: 'fantasy armor', text: 'Fantasy Armor'}, { value: 'modern street clothes', text: 'Modern Street Clothes'}],
                    hairStyles: [{ value: 'short hair', text: 'Short Hair'}, { value: 'long hair', text: 'Long Hair'}, { value: 'spiky hair', text: 'Spiky Hair'}, { value: 'braided hair', text: 'Braided Hair'}, { value: 'no hair', text: 'No Hair'}, { value: 'long ponytail', text: 'Long Ponytail'}, { value: 'mohawk', text: 'Mohawk'}, { value: 'shaved head', text: 'Shaved Head'}, { value: 'curly hair', text: 'Curly Hair'}],
                    tailStyles: [{ value: 'long fluffy tail', text: 'Long Fluffy Tail' }, { value: 'short bushy tail', text: 'Short Bushy Tail' }, { value: 'spiky tail', text: 'Spiky Tail' }, { value: 'thin and long tail', text: 'Thin and Long Tail' }, { value: 'dragon-like tail', text: 'Dragon-like Tail' }, { value: 'curly tail', text: 'Curly Tail' }, { value: 'bobtail', text: 'Bobtail' }, { value: 'scaly tail', text: 'Scaly Tail' }],
                    earStyles: [{ value: 'large pointy ears', text: 'Large Pointy Ears' }, { value: 'floppy ears', text: 'Floppy Ears' }, { value: 'short and round ears', text: 'Short and Round Ears' }, { value: 'long rabbit-like ears', text: 'Long Rabbit-like Ears' }, { value: 'round ears', text: 'Round Ears' }, { value: 'pointed ears', text: 'Pointed Ears' }, { value: 'folded ears', text: 'Folded Ears' }],
                    framings: [{ value: 'full body', text: 'Full Body' }, { value: 'bust-up', text: 'Bust-up' }, { value: 'headshot', text: 'Headshot' }, { value: 'half-body', text: 'Half-body' }],
                    facialExpressions: [{ value: 'smiling', text: 'Smiling' }, { value: 'neutral', text: 'Neutral' }, { value: 'serious', text: 'Serious' }, { value: 'surprised', text: 'Surprised' }, { value: 'angry', text: 'Angry' }, { value: 'sad', text: 'Sad' }],
                    gazeDirections: [{ value: 'looking straight at the camera', text: 'Looking straight at the camera' }, { value: 'looking to the left', text: 'Looking to the left' }, { value: 'looking to the right', text: 'Looking to the right' }, { value: 'looking up', text: 'Looking up' }, { value: 'looking down', text: 'Looking down' }]
                }
            };

            const updateUI = (lang) => {
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.getAttribute('data-lang-key');
                    if (translations[lang][key]) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = translations[lang][key];
                        } else {
                            element.textContent = translations[lang][key];
                        }
                    }
                });

                const populateSelect = (selectElement, options, selectedValue) => {
                    selectElement.innerHTML = '';
                    options.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.value;
                        opt.textContent = option.text;
                        if (option.value === selectedValue) {
                            opt.selected = true;
                        }
                        selectElement.appendChild(opt);
                    });
                };

                const animals = translations[lang].animals;
                const genders = translations[lang].genders;
                const artStyles = translations[lang].artStyles;
                const poses = translations[lang].poses;
                const backgrounds = translations[lang].backgrounds;
                const clothing = translations[lang].clothing;
                const hairStyles = translations[lang].hairStyles;
                const tailStyles = translations[lang].tailStyles;
                const earStyles = translations[lang].earStyles;
                const framings = translations[lang].framings;
                const facialExpressions = translations[lang].facialExpressions;
                const gazeDirections = translations[lang].gazeDirections;

                populateSelect(animal1Select, animals, animal1Select.value);
                populateSelect(animal2Select, [{ value: 'none', text: translations[lang].animal2Label.replace(' (Opcional)', '').replace(' (Optional)', '') }, ...animals], animal2Select.value);
                populateSelect(genderSelect, genders, genderSelect.value);
                populateSelect(artStyleSelect, artStyles, artStyleSelect.value);
                populateSelect(poseSelect, poses, poseSelect.value);
                populateSelect(backgroundSelect, backgrounds, backgroundSelect.value);
                populateSelect(clothingSelect, clothing, clothingSelect.value);
                populateSelect(hairStyleSelect, hairStyles, hairStyleSelect.value);
                populateSelect(tailStyleSelect, tailStyles, tailStyleSelect.value);
                populateSelect(earStyleSelect, earStyles, earStyleSelect.value);
                populateSelect(framingSelect, framings, framingSelect.value);
                populateSelect(facialExpressionSelect, facialExpressions, facialExpressionSelect.value);
                populateSelect(gazeDirectionSelect, gazeDirections, gazeDirectionSelect.value);
            };

            updateUI(languageSelect.value);

            languageSelect.addEventListener('change', (e) => {
                const lang = e.target.value;
                updateUI(lang);
            });

            const apiKey = "";
            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=" + apiKey;

            const getProportionDescription = (value) => {
                if (value < 20) return 'very small';
                if (value < 40) return 'small';
                if (value < 60) return 'proportionate';
                if (value < 80) return 'large';
                return 'very large';
            };

            const generateImage = async (isRegenerate = false) => {
                generateButton.disabled = true;
                regenerateButton.disabled = true;
                editButton.disabled = true;
                downloadButton.disabled = true;
                loadingOverlay.classList.add('visible');
                loadingText.textContent = translations[languageSelect.value].loadingText;
                resultImage.classList.remove('visible');
                actionButtonsDiv.classList.add('hidden');

                let prompt = '';
                if (!isRegenerate) {
                    const animal1 = animal1Select.value;
                    const animal2 = animal2Select.value === 'none' ? '' : `and a ${animal2Select.value}`;
                    const gender = genderSelect.value;
                    const artStyle = artStyleSelect.value;
                    const pose = poseSelect.value;
                    const background = backgroundSelect.value;
                    const primaryColor = primaryColorInput.value.trim();
                    const clothingStyle = clothingSelect.value;
                    const hairStyle = hairStyleSelect.value;
                    const tailStyle = tailStyleSelect.value;
                    const earStyle = earStyleSelect.value;
                    const traits = traitsInput.value.trim();
                    const framing = framingSelect.value;

                    const headSize = getProportionDescription(parseInt(headSizeInput.value));
                    const chestSize = getProportionDescription(parseInt(chestSizeInput.value));
                    const legsSize = getProportionDescription(parseInt(legsSizeInput.value));
                    const bustSize = getProportionDescription(parseInt(bustSizeInput.value));
                    
                    if (clothingStyle === 'no clothes') {
                        prompt = `A detailed, SFW, non-sexual, feral furry fursona, a ${framing} shot of an anthropomorphic hybrid of a ${animal1} ${animal2}. The character has a ${gender} body type, with naturalistic ${primaryColor} fur patterns and markings. It has a ${headSize} head, ${chestSize} chest, ${legsSize} legs, and ${bustSize} bust. It has ${hairStyle}, a ${tailStyle} and ${earStyle}. The character is not wearing any clothes, with fur covering body parts in a naturalistic way. The art style is a vivid ${artStyle}. It is posed ${pose} against a ${background}. Other traits: ${traits}. The character's fur is ${primaryColor}. Safe for work.`;
                    } else {
                        const clothingPrompt = `wearing ${clothingStyle}`;
                        prompt = `A detailed, SFW furry fursona, a ${framing} shot of an anthropomorphic hybrid of a ${animal1} ${animal2}. The character has a ${gender} body type, with ${primaryColor} fur and markings. It has a ${headSize} head, ${chestSize} chest, ${legsSize} legs, and ${bustSize} bust. It has ${hairStyle}, a ${tailStyle} and ${earStyle}. It is ${clothingPrompt}. The art style is a vivid ${artStyle}. It is posed ${pose} against a ${background}. Other traits: ${traits}. The character's fur is ${primaryColor}. Safe for work.`;
                    }
                    lastPrompt = prompt;
                } else {
                    const facialExpression = facialExpressionSelect.value;
                    const gazeDirection = gazeDirectionSelect.value;
                    prompt = lastPrompt + `, with a ${facialExpression} expression and ${gazeDirection}.`;
                }

                console.log("Prompt a ser enviado:", prompt);

                let retries = 0;
                const maxRetries = 3;
                let backoffDelay = 1000;

                while (retries < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                instances: { prompt: prompt },
                                parameters: { "sampleCount": 1 }
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
                        
                        if (base64Data) {
                            imageDataUrl = `data:image/png;base64,${base64Data}`;
                            resultImage.src = imageDataUrl;
                            resultImage.onload = () => {
                                loadingOverlay.classList.remove('visible');
                                resultImage.classList.add('visible');
                                generateButton.disabled = false;
                                regenerateButton.disabled = false;
                                editButton.disabled = false;
                                downloadButton.disabled = false;
                                actionButtonsDiv.classList.remove('hidden');
                            };
                            return;
                        } else {
                            throw new Error('No image data received from API.');
                        }
                    } catch (error) {
                        console.error("Erro ao gerar a imagem:", error);
                        retries++;
                        if (retries < maxRetries) {
                            loadingText.textContent = translations[languageSelect.value].errorText;
                            await new Promise(res => setTimeout(res, backoffDelay));
                            backoffDelay *= 2;
                        } else {
                            loadingOverlay.classList.remove('visible');
                            resultImage.src = "https://placehold.co/400x400/d946ef/FFFFFF?text=Erro+ao+Gerar+Imagem";
                            resultImage.classList.add('visible');
                            generateButton.disabled = false;
                            regenerateButton.disabled = false;
                            editButton.disabled = false;
                            downloadButton.disabled = false;
                            actionButtonsDiv.classList.remove('hidden');
                            loadingText.textContent = translations[languageSelect.value].finalErrorText;
                            break;
                        }
                    }
                }
            };

            const showEditPanel = () => {
                mainPanel.classList.add('hidden');
                editPanel.classList.remove('hidden');
            };

            const showMainPanel = () => {
                editPanel.classList.add('hidden');
                mainPanel.classList.remove('hidden');
            };
            
            const downloadImage = () => {
                if (imageDataUrl) {
                    const link = document.createElement('a');
                    link.href = imageDataUrl;
                    link.download = 'fursona_gerado.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            };
            
            // Adiciona part√≠culas de patinhas de forma aleat√≥ria na tela
            function createPawParticle() {
                const particle = document.createElement('div');
                particle.classList.add('paw-particle');
                particle.textContent = 'üêæ';
                
                const size = Math.random() * 20 + 10;
                const duration = Math.random() * 4 + 4;
                const left = Math.random() * 100;

                particle.style.fontSize = `${size}px`;
                particle.style.left = `${left}%`;
                particle.style.animationDuration = `${duration}s`;
                
                document.body.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, duration * 1000);
            }

            setInterval(createPawParticle, 500);

            generateButton.addEventListener('click', () => generateImage(false));
            regenerateButton.addEventListener('click', () => generateImage(true));
            editButton.addEventListener('click', showEditPanel);
            backButton.addEventListener('click', showMainPanel);
            downloadButton.addEventListener('click', downloadImage);
        });
    </script>
</body>
</html>
